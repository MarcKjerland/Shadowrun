<html>
    <head>
        <script src="functions.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    </head>

    <body>

    <div class="dicePoolSlider">
        <input type="range" min="1" max="30" value="12" class="slider" id="diceRange">
        <p>Number of Dice: <span id="currentDiceValue"></span></p>
    </div>

    <div class="forceSlider">
        <input type="range" min="1" max="16" value="6" class="slider" id="forceRange">
        <p>Desired Force: <span id="currentForceValue"></span></p>
    </div>

    <div>
        <canvas id="chart" width="100%" height="50%"></canvas>
    </div>

<script>
    //hits on 1/3 of attempts
    var successRate=1/3;

    //dice slider
    var diceSlider = document.getElementById("diceRange");
    var diceOutput = document.getElementById("currentDiceValue");
    diceOutput.innerHTML = diceSlider.value;

    diceSlider.oninput = function(data) {
        diceOutput.innerHTML = this.value;
        diceNumber = parseInt(diceSlider.value);
        clearData();
        calculateResults();

    }

    //force slider
    var forceSlider = document.getElementById("forceRange");
    var forceOutput = document.getElementById("currentForceValue");
    forceOutput.innerHTML = forceSlider.value;

    forceSlider.oninput = function() {
        forceOutput.innerHTML = this.value;
        console.log(forceSlider.value);
        resultsChart.update();
    }

    //chart stuff
    var ctx = document.getElementById('chart');
    var chartLabel=[];
    var data=[];
    var diceNumber = parseInt(diceSlider.value);
    var forceNumber = parseInt(forceSlider.value);

    var resultsChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: chartLabel,
            datasets: [{
                label: 'Chance of Success',
                data: data,
                borderColor: 'rgba(255,0,0,1)',
                borderWidth: 1

            }]
        },
        options: {
            responsive: true
        }
    })


    calculateResults();            

    function clearData() {
        data = [];
        chartLabel = [];
    }


    function calculateResults() {
        console.log('Calculating!');

        for (k = 0; k <= diceNumber; k++) {
            probability = BinomTerm(successRate, diceNumber, k);
            // console.log('Successes: ', k, '      Success probability: ', probability);
            data.push(probability);
            chartLabel.push(k);
            }
        resultsChart.data.datasets[0].data = data;
        resultsChart.update('active');

    }


</script>

</body>
</html>     